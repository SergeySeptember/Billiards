<?xml version="1.0" encoding="utf-8"?>

<ContentView
    x:Class="Billiards.Views.MatchView"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:viewModels="clr-namespace:Billiards.ViewModels"
    xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit">

    <ContentView.Resources>
        <Style x:Key="PlayerPickerStyle" TargetType="Picker">
            <Setter Property="FontAttributes" Value="Bold" />
            <Setter Property="FontSize" Value="16" />
            <Setter Property="TextColor" Value="{DynamicResource PrimaryTextColor}" />
            <Setter Property="HorizontalTextAlignment" Value="Center" />
        </Style>

        <Style x:Key="SectionTitleStyle" TargetType="Label">
            <Setter Property="FontSize" Value="18" />
            <Setter Property="FontAttributes" Value="Bold" />
            <Setter Property="HorizontalTextAlignment" Value="Center" />
        </Style>

        <Style x:Key="ScoreValueStyle" TargetType="Label">
            <Setter Property="FontSize" Value="24" />
            <Setter Property="FontAttributes" Value="Bold" />
            <Setter Property="HorizontalTextAlignment" Value="Center" />
        </Style>
    </ContentView.Resources>

    <ScrollView>
        <Border Padding="14"
                StrokeThickness="1"
                Stroke="{AppThemeBinding Light=#DDDDDD, Dark=#444444}"
                StrokeShape="RoundRectangle 20">

            <Grid x:Name="Root"
                  Padding="16"
                  RowSpacing="6"
                  ColumnSpacing="6"
                  x:DataType="viewModels:MatchViewModel">

                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <!-- 0: –¢–∏–ø –±–∏–ª—å—è—Ä–¥–∞ -->
                    <RowDefinition Height="Auto" />
                    <!-- 1: –ò–≥—Ä–æ–∫–∏ -->
                    <RowDefinition Height="Auto" />
                    <!-- 2: –†–∞–∑–±–∏–≤–∞–µ—Ç -->
                    <RowDefinition Height="Auto" />
                    <!-- 3: –ó–∞–≥–æ–ª–æ–≤–æ–∫: –∑–∞–±–∏—Ç—ã–µ -->
                    <RowDefinition Height="Auto" />
                    <!-- 4: –ó–∞–±–∏—Ç—ã–µ: –∑–Ω–∞—á–µ–Ω–∏—è -->
                    <RowDefinition Height="Auto" />
                    <!-- 5: –ó–∞–±–∏—Ç—ã–µ: –∫–Ω–æ–ø–∫–∏ -->
                    <RowDefinition Height="Auto" />
                    <!-- 6: –ó–∞–≥–æ–ª–æ–≤–æ–∫: –¥—É—Ä–∞–∫–∏ -->
                    <RowDefinition Height="Auto" />
                    <!-- 7: –î—É—Ä–∞–∫–∏: –∑–Ω–∞—á–µ–Ω–∏—è -->
                    <RowDefinition Height="Auto" />
                    <!-- 8: –î—É—Ä–∞–∫–∏: –∫–Ω–æ–ø–∫–∏ -->
                    <RowDefinition Height="Auto" />
                    <!-- 9: –ó–∞–≥–æ–ª–æ–≤–æ–∫: —à—Ç—Ä–∞—Ñ—ã -->
                    <RowDefinition Height="Auto" />
                    <!-- 10: –®—Ç—Ä–∞—Ñ—ã: –∑–Ω–∞—á–µ–Ω–∏—è -->
                    <RowDefinition Height="Auto" />
                    <!-- 11: –®—Ç—Ä–∞—Ñ—ã: –∫–Ω–æ–ø–∫–∏ -->
                    <RowDefinition Height="Auto" />
                    <!-- 12: –¢–∞–π–º–µ—Ä -->
                    <RowDefinition Height="Auto" />
                    <!-- 13: –ö–Ω–æ–ø–∫–∏ (–°—Ç–∞—Ä—Ç/–°—Ç–æ–ø + –ù–æ–≤–∞—è –ø–∞—Ä—Ç–∏—è) -->
                </Grid.RowDefinitions>

                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <!-- –¢–∏–ø –±–∏–ª—å—è—Ä–¥–∞ -->
                <Picker Grid.Row="0"
                        Grid.ColumnSpan="2"
                        Title="–í–∏–¥ –±–∏–ª—å—è—Ä–¥–∞"
                        Style="{StaticResource PlayerPickerStyle}"
                        FontSize="18"
                        SelectedItem="{Binding SelectedGameType, Mode=TwoWay}"
                        IsEnabled="{Binding IsEditable}">
                    <Picker.Items>
                        <x:String>–°–≤–æ–±–æ–¥–Ω–∞—è –ø–∏—Ä–∞–º–∏–¥–∞</x:String>
                        <x:String>–°–∏–±–∏—Ä—Å–∫–∞—è –ø–∏—Ä–∞–º–∏–¥–∞</x:String>
                        <x:String>–ú–æ—Å–∫–æ–≤—Å–∫–∞—è –ø–∏—Ä–∞–º–∏–¥–∞</x:String>
                        <x:String>–ù–µ–≤—Å–∫–∞—è –ø–∏—Ä–∞–º–∏–¥–∞</x:String>
                        <x:String>–ë–µ—Å–∫–æ–Ω–µ—á–Ω–∞—è –ø–∏—Ä–∞–º–∏–¥–∞</x:String>
                    </Picker.Items>
                </Picker>

                <!-- –ò–≥—Ä–æ–∫–∏ -->
                <Grid Grid.Row="1"
                      Grid.ColumnSpan="2"
                      ColumnSpacing="8">

                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <!-- –ò–≥—Ä–æ–∫ A -->
                    <Grid Grid.Column="0">

                        <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ -->
                        <Border Padding="8"
                                StrokeThickness="1"
                                Stroke="{AppThemeBinding Light=#DDDDDD, Dark=#444444}"
                                StrokeShape="RoundRectangle 14">

                            <Border.Behaviors>
                                <toolkit:TouchBehavior
                                    IsEnabled="True"
                                    ShouldMakeChildrenInputTransparent="False"
                                    LongPressDuration="650"
                                    PressedScale="0.98"
                                    PressedOpacity="0.9"
                                    LongPressCommand="{Binding BindingContext.ToggleBreakShotCommand, Source={x:Reference Root}}"
                                    LongPressCommandParameter="{Binding BindingContext.PlayerA, Source={x:Reference Root}}" />
                            </Border.Behaviors>

                            <VerticalStackLayout Spacing="2">
                                <Label Text="–ü–µ—Ä–≤—ã–π –∏–≥—Ä–æ–∫"
                                       HorizontalTextAlignment="Center"
                                       FontAttributes="Bold" />

                                <Picker ItemsSource="{Binding Players}"
                                        ItemDisplayBinding="{Binding Name}"
                                        SelectedItem="{Binding PlayerA, Mode=TwoWay}"
                                        IsEnabled="{Binding IsEditable}"
                                        Style="{StaticResource PlayerPickerStyle}" />

                                <Border Padding="6,2"
                                        Margin="0,4,0,0"
                                        HorizontalOptions="Center"
                                        StrokeThickness="0"
                                        BackgroundColor="{AppThemeBinding Light=#FFB300, Dark=#FFB300}"
                                        StrokeShape="RoundRectangle 999"
                                        IsVisible="{Binding IsBreakShotA}">
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding ClearBreakShotCommand}" />
                                    </Border.GestureRecognizers>

                                    <Label Text="üé± –ó–∞–±–∏—Ç–∏–µ —Å —Ä–∞–∑–±–æ—è"
                                           FontAttributes="Bold"
                                           FontSize="12"
                                           TextColor="Black" />
                                </Border>
                            </VerticalStackLayout>
                        </Border>

                        <Border IsVisible="{Binding IsBreakShotA}"
                                InputTransparent="True"
                                Stroke="{AppThemeBinding Light=#FFB300, Dark=#FFB300}"
                                StrokeThickness="2"
                                BackgroundColor="{AppThemeBinding Light=#FFF3CD, Dark=#3A2F12}"
                                Opacity="0.35"
                                StrokeShape="RoundRectangle 14" />
                    </Grid>

                    <!-- –ò–≥—Ä–æ–∫ B -->
                    <Grid Grid.Column="1">

                        <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ -->
                        <Border Padding="8"
                                StrokeThickness="1"
                                Stroke="{AppThemeBinding Light=#DDDDDD, Dark=#444444}"
                                StrokeShape="RoundRectangle 14">

                            <Border.Behaviors>
                                <toolkit:TouchBehavior
                                    IsEnabled="True"
                                    ShouldMakeChildrenInputTransparent="False"
                                    LongPressDuration="650"
                                    PressedScale="0.98"
                                    PressedOpacity="0.9"
                                    LongPressCommand="{Binding BindingContext.ToggleBreakShotCommand, Source={x:Reference Root}}"
                                    LongPressCommandParameter="{Binding BindingContext.PlayerB, Source={x:Reference Root}}" />
                            </Border.Behaviors>

                            <VerticalStackLayout Spacing="2">
                                <Label Text="–í—Ç–æ—Ä–æ–π –∏–≥—Ä–æ–∫"
                                       HorizontalTextAlignment="Center"
                                       FontAttributes="Bold" />

                                <Picker ItemsSource="{Binding Players}"
                                        ItemDisplayBinding="{Binding Name}"
                                        SelectedItem="{Binding PlayerB, Mode=TwoWay}"
                                        IsEnabled="{Binding IsEditable}"
                                        Style="{StaticResource PlayerPickerStyle}" />

                                <Border Padding="6,2"
                                        Margin="0,4,0,0"
                                        HorizontalOptions="Center"
                                        StrokeThickness="0"
                                        BackgroundColor="{AppThemeBinding Light=#FFB300, Dark=#FFB300}"
                                        StrokeShape="RoundRectangle 999"
                                        IsVisible="{Binding IsBreakShotB}">
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding ClearBreakShotCommand}" />
                                    </Border.GestureRecognizers>

                                    <Label Text="üé± –ó–∞–±–∏—Ç–∏–µ —Å —Ä–∞–∑–±–æ—è"
                                           FontAttributes="Bold"
                                           FontSize="12"
                                           TextColor="Black" />
                                </Border>
                            </VerticalStackLayout>
                        </Border>

                        <Border IsVisible="{Binding IsBreakShotB}"
                                InputTransparent="True"
                                Stroke="{AppThemeBinding Light=#FFB300, Dark=#FFB300}"
                                StrokeThickness="2"
                                BackgroundColor="{AppThemeBinding Light=#FFF3CD, Dark=#3A2F12}"
                                Opacity="0.35"
                                StrokeShape="RoundRectangle 14" />
                    </Grid>
                </Grid>


                <!-- –†–∞–∑–±–∏–≤–∞–µ—Ç -->
                <Grid Grid.Row="2"
                      Grid.ColumnSpan="2"
                      ColumnDefinitions="Auto,*"
                      ColumnSpacing="8"
                      VerticalOptions="Center">

                    <Label Text="–†–∞–∑–±–∏–≤–∞–µ—Ç:"
                           FontAttributes="Bold"
                           VerticalTextAlignment="Center"
                           FontSize="16" />

                    <Picker Grid.Column="1"
                            Title="–í—ã–±–µ—Ä–∏ –∏–≥—Ä–æ–∫–∞"
                            ItemsSource="{Binding BreakerCandidates}"
                            ItemDisplayBinding="{Binding Name}"
                            SelectedItem="{Binding BreakerPlayer, Mode=TwoWay}"
                            IsEnabled="{Binding IsEditable}"
                            Style="{StaticResource PlayerPickerStyle}" />
                </Grid>

                <!-- –ó–∞–±–∏—Ç—ã–µ -->
                <Label Grid.Row="3"
                       Grid.ColumnSpan="2"
                       Text="–ó–∞–±–∏—Ç—ã–µ —à–∞—Ä—ã"
                       Style="{StaticResource SectionTitleStyle}" />

                <Grid Grid.Row="4" Grid.ColumnSpan="2" ColumnSpacing="8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <Label Grid.Column="0" Text="{Binding MainBallsA}" Style="{StaticResource ScoreValueStyle}" />
                    <Label Grid.Column="1" Text="{Binding MainBallsB}" Style="{StaticResource ScoreValueStyle}" />
                </Grid>

                <Grid Grid.Row="5" Grid.ColumnSpan="2" ColumnSpacing="8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <HorizontalStackLayout Grid.Column="0" HorizontalOptions="Center">
                        <Button Text=" + " FontSize="24" FontAttributes="Bold"
                                Command="{Binding MainBallsIncrementACommand}" />
                        <Button Text=" - " FontSize="28" FontAttributes="Bold" Margin="16,0,0,0"
                                Command="{Binding MainBallsDecrementACommand}" />
                    </HorizontalStackLayout>

                    <HorizontalStackLayout Grid.Column="1" HorizontalOptions="Center">
                        <Button Text=" + " FontSize="24" FontAttributes="Bold"
                                Command="{Binding MainBallsIncrementBCommand}" />
                        <Button Text=" - " FontSize="28" FontAttributes="Bold" Margin="16,0,0,0"
                                Command="{Binding MainBallsDecrementBCommand}" />
                    </HorizontalStackLayout>
                </Grid>

                <!-- –î—É—Ä–∞–∫–∏ -->
                <Label Grid.Row="6"
                       Grid.ColumnSpan="2"
                       Text="–î—É—Ä–∞–∫–∏"
                       Style="{StaticResource SectionTitleStyle}" />

                <Grid Grid.Row="7" Grid.ColumnSpan="2" ColumnSpacing="8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <Label Grid.Column="0" Text="{Binding AccidentalBallsA}" Style="{StaticResource ScoreValueStyle}" />
                    <Label Grid.Column="1" Text="{Binding AccidentalBallsB}" Style="{StaticResource ScoreValueStyle}" />
                </Grid>

                <Grid Grid.Row="8" Grid.ColumnSpan="2" ColumnSpacing="8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <HorizontalStackLayout Grid.Column="0" HorizontalOptions="Center">
                        <Button Text=" + " FontSize="24" FontAttributes="Bold"
                                Command="{Binding AccidentalBallsIncrementACommand}" />
                        <Button Text=" - " FontSize="28" FontAttributes="Bold" Margin="16,0,0,0"
                                Command="{Binding AccidentalBallsDecrementACommand}" />
                    </HorizontalStackLayout>

                    <HorizontalStackLayout Grid.Column="1" HorizontalOptions="Center">
                        <Button Text=" + " FontSize="24" FontAttributes="Bold"
                                Command="{Binding AccidentalBallsIncrementBCommand}" />
                        <Button Text=" - " FontSize="28" FontAttributes="Bold" Margin="16,0,0,0"
                                Command="{Binding AccidentalBallsDecrementBCommand}" />
                    </HorizontalStackLayout>
                </Grid>

                <!-- –®—Ç—Ä–∞—Ñ—ã -->
                <Label Grid.Row="9"
                       Grid.ColumnSpan="2"
                       Text="–®—Ç—Ä–∞—Ñ—ã"
                       Style="{StaticResource SectionTitleStyle}" />

                <Grid Grid.Row="10" Grid.ColumnSpan="2" ColumnSpacing="8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <Label Grid.Column="0" Text="{Binding FoulsA}" Style="{StaticResource ScoreValueStyle}" />
                    <Label Grid.Column="1" Text="{Binding FoulsB}" Style="{StaticResource ScoreValueStyle}" />
                </Grid>

                <Grid Grid.Row="11" Grid.ColumnSpan="2" ColumnSpacing="8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <HorizontalStackLayout Grid.Column="0" HorizontalOptions="Center">
                        <Button Text=" + " FontSize="24" FontAttributes="Bold"
                                Command="{Binding FoulsIncrementACommand}" />
                        <Button Text=" - " FontSize="28" FontAttributes="Bold" Margin="16,0,0,0"
                                Command="{Binding FoulsDecrementACommand}" />
                    </HorizontalStackLayout>

                    <HorizontalStackLayout Grid.Column="1" HorizontalOptions="Center">
                        <Button Text=" + " FontSize="24" FontAttributes="Bold"
                                Command="{Binding FoulsIncrementBCommand}" />
                        <Button Text=" - " FontSize="28" FontAttributes="Bold" Margin="16,0,0,0"
                                Command="{Binding FoulsDecrementBCommand}" />
                    </HorizontalStackLayout>
                </Grid>

                <!-- –¢–∞–π–º–µ—Ä -->
                <Label Grid.Row="12"
                       Grid.ColumnSpan="2"
                       HorizontalOptions="Center"
                       FontSize="36"
                       Text="{Binding TimerText}" />

                <!-- –ö–Ω–æ–ø–∫–∏: –°—Ç–∞—Ä—Ç/–°—Ç–æ–ø + –ù–æ–≤–∞—è –ø–∞—Ä—Ç–∏—è -->
                <Grid Grid.Row="13"
                      Grid.ColumnSpan="2"
                      ColumnSpacing="8"
                      Margin="0,10,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <Button Grid.Column="0"
                            FontSize="18"
                            Text="{Binding StartStopButtonText}"
                            Command="{Binding StartStopCommand}" />

                    <Button Grid.Column="1"
                            FontSize="18"
                            Text="–ù–æ–≤–∞—è –ø–∞—Ä—Ç–∏—è"
                            Command="{Binding NewMatchCommand}" />
                </Grid>

            </Grid>
        </Border>
    </ScrollView>
</ContentView>